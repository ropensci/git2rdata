<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Storing Large Dataframes • git2rdata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Storing Large Dataframes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">git2rdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/plain_text.html">Getting started storing dataframes as plain text</a></li>
    <li><a class="dropdown-item" href="../articles/version_control.html">Storing dataframes under version control</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">Potential workflow</a></li>
    <li><a class="dropdown-item" href="../articles/efficiency.html">Efficiency</a></li>
    <li><a class="dropdown-item" href="../articles/split_by.html">Large dataframes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../CONTRIBUTING.html">Contributing</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/git2rdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Storing Large Dataframes</h1>
                        <h4 data-toc-skip class="author">Thierry
Onkelinx</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/git2rdata/blob/main/vignettes/split_by.Rmd" class="external-link"><code>vignettes/split_by.Rmd</code></a></small>
      <div class="d-none name"><code>split_by.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Sometimes, a large dataframe has one or more variables with a small
number of unique combinations. E.g. a dataframe with one or more factor
variables. Storing the entire dataframe as a single text file requires
storing lots of replicated data. Each row stores the information for
every variable, even if a subset of these variables remains constant
over a subset of the data.</p>
<p>In such a case we can use the <code>split_by</code> argument of
<code><a href="../reference/write_vc.html">write_vc()</a></code>. This will store the large dataframe over a set
of tab separated files. One file for every combination of the variables
defined by <code>split_by</code>. Every partial data file holds the
other variables for one combination of <code>split_by</code>. We remove
the <code>split_by</code> variables from the partial data files,
reducing their size. We add an <code>index.tsv</code> containing the
combinations of the <code>split_by</code> variables and a unique hash
for each combination. This hash becomes the base name of the partial
data files.</p>
<p>Splitting the dataframe into smaller files makes them easier to
handle in version control system. The total size depends on the amount
of replication in the dataframe. More on that in the next section.</p>
</div>
<div class="section level2">
<h2 id="when-to-split-the-dataframe">When to Split the Dataframe<a class="anchor" aria-label="anchor" href="#when-to-split-the-dataframe"></a>
</h2>
<p>Let’s set the following variables:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>:
the average number of bytes to store a single line of the
<code>split_by</code> variables.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>:
the average number of bytes to store a single line of the remaining
variables.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>s</mi></msub><annotation encoding="application/x-tex">h_s</annotation></semantics></math>:
the number of bytes to store the header of the <code>split_by</code>
variables.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>r</mi></msub><annotation encoding="application/x-tex">h_r</annotation></semantics></math>:
the number of bytes to store the header of the remaining
variables.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>:
the number of rows in the dataframe.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>s</mi></msub><annotation encoding="application/x-tex">N_s</annotation></semantics></math>:
the number of unique combinations of the <code>split_by</code>
variables.</p></li>
</ul>
<p>Storing the dataframe with <code><a href="../reference/write_vc.html">write_vc()</a></code> without
<code>split_by</code> requires
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>s</mi></msub><mo>+</mo><msub><mi>h</mi><mi>r</mi></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">h_s + h_r + 1</annotation></semantics></math>
bytes for the header and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>+</mo><mi>r</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s + r + 1</annotation></semantics></math>
bytes for every observation. The total number of bytes is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub><mo>=</mo><msub><mi>h</mi><mi>s</mi></msub><mo>+</mo><msub><mi>h</mi><mi>r</mi></msub><mo>+</mo><mn>1</mn><mo>+</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>+</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">T_0 = h_s + h_r + 1 + N (s + r + 1)</annotation></semantics></math>.
Both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>+</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">+ 1</annotation></semantics></math>
originate from the tab character to separate the <code>split_by</code>
variables from the remaining variables.</p>
<p>Storing the dataframe with <code><a href="../reference/write_vc.html">write_vc()</a></code> with
<code>split_by</code> requires an index file to store the combinations
of the <code>split_by</code> variables. It will use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>s</mi></msub><annotation encoding="application/x-tex">h_s</annotation></semantics></math>
bytes for the header and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>s</mi></msub><mi>s</mi></mrow><annotation encoding="application/x-tex">N_s s</annotation></semantics></math>
for the data. The headers of the partial data files require
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>s</mi></msub><msub><mi>h</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">N_s h_r</annotation></semantics></math>
bytes
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>s</mi></msub><annotation encoding="application/x-tex">N_s</annotation></semantics></math>
files and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>r</mi></msub><annotation encoding="application/x-tex">h_r</annotation></semantics></math>
byte per file). The data in the partial data files require
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">N r</annotation></semantics></math>
bytes. The total number of bytes is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>s</mi></msub><mo>=</mo><msub><mi>h</mi><mi>s</mi></msub><mo>+</mo><msub><mi>N</mi><mi>s</mi></msub><mi>s</mi><mo>+</mo><msub><mi>N</mi><mi>s</mi></msub><msub><mi>h</mi><mi>r</mi></msub><mo>+</mo><mi>N</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">T_s = h_s + N_s s + N_s h_r + N r</annotation></semantics></math>.</p>
<p>We can look at the ratio of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>s</mi></msub><annotation encoding="application/x-tex">T_s</annotation></semantics></math>
over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mn>0</mn></msub><annotation encoding="application/x-tex">T_0</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mn>0</mn></msub></mfrac><mo>=</mo><mfrac><mrow><msub><mi>h</mi><mi>s</mi></msub><mo>+</mo><msub><mi>N</mi><mi>s</mi></msub><mi>s</mi><mo>+</mo><msub><mi>N</mi><mi>s</mi></msub><msub><mi>h</mi><mi>r</mi></msub><mo>+</mo><mi>N</mi><mi>r</mi></mrow><mrow><msub><mi>h</mi><mi>s</mi></msub><mo>+</mo><msub><mi>h</mi><mi>r</mi></msub><mo>+</mo><mn>1</mn><mo>+</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>+</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_s}{T_0} = \frac{h_s + N_s s + N_s h_r + N r}{h_s + h_r + 1 + N (s + r + 1)}</annotation></semantics></math></p>
<p>Let’s simplify the equation by assuming that we need an equal amount
of character for the headers and the data
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>s</mi></msub><mo>=</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">h_s = s</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>r</mi></msub><mo>=</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">h_r = r</annotation></semantics></math>).</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mn>0</mn></msub></mfrac><mo>=</mo><mfrac><mrow><mi>s</mi><mo>+</mo><msub><mi>N</mi><mi>s</mi></msub><mi>s</mi><mo>+</mo><msub><mi>N</mi><mi>s</mi></msub><mi>r</mi><mo>+</mo><mi>N</mi><mi>r</mi></mrow><mrow><mi>s</mi><mo>+</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo>+</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>+</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_s}{T_0} = \frac{s + N_s s + N_s r + N r}{s + r + 1 + N (s + r + 1)}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mn>0</mn></msub></mfrac><mo>=</mo><mfrac><mrow><mi>s</mi><mo>+</mo><msub><mi>N</mi><mi>s</mi></msub><mi>s</mi><mo>+</mo><msub><mi>N</mi><mi>s</mi></msub><mi>r</mi><mo>+</mo><mi>N</mi><mi>r</mi></mrow><mrow><mi>s</mi><mo>+</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo>+</mo><mi>N</mi><mi>s</mi><mo>+</mo><mi>N</mi><mi>r</mi><mo>+</mo><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_s}{T_0} = \frac{s + N_s s + N_s r + N r}{s + r + 1 + N s + N r + N}</annotation></semantics></math></p>
<p>Let assume that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">s = a r</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">0 &lt; a</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>s</mi></msub><mo>=</mo><mi>b</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">N_s = b N</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>b</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 &lt; b &lt; 1</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mn>0</mn></msub></mfrac><mo>=</mo><mfrac><mrow><mi>a</mi><mi>r</mi><mo>+</mo><mi>N</mi><mi>a</mi><mi>b</mi><mi>r</mi><mo>+</mo><mi>N</mi><mi>b</mi><mi>r</mi><mo>+</mo><mi>N</mi><mi>r</mi></mrow><mrow><mi>a</mi><mi>r</mi><mo>+</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo>+</mo><mi>N</mi><mi>a</mi><mi>r</mi><mo>+</mo><mi>N</mi><mi>r</mi><mo>+</mo><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_s}{T_0} = \frac{a r + N a b r + N b r + N r}{a r + r + 1 + N a r + N r + N}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mn>0</mn></msub></mfrac><mo>=</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>N</mi><mi>a</mi><mi>b</mi><mo>+</mo><mi>N</mi><mi>b</mi><mo>+</mo><mi>N</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>r</mi></mrow><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mi>r</mi><mo>+</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_s}{T_0} = \frac{(a + N a b + N b + N) r}{(N + 1) (a r + r + 1)}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mn>0</mn></msub></mfrac><mo>=</mo><mfrac><mrow><mi>a</mi><mo>+</mo><mi>N</mi><mi>a</mi><mi>b</mi><mo>+</mo><mi>N</mi><mi>b</mi><mo>+</mo><mi>N</mi></mrow><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo>+</mo><mn>1</mn><mi>/</mi><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_s}{T_0} = \frac{a + N a b + N b + N}{(N + 1) (a + 1 + 1 / r)}</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mn>0</mn></msub></mfrac><mo>=</mo><mfrac><mrow><mi>a</mi><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mi>b</mi><mo>+</mo><mi>b</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>N</mi></mrow><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo>+</mo><mn>1</mn><mi>/</mi><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_s}{T_0} = \frac{a + (a b + b + 1) N }{(N + 1) (a + 1 + 1 / r)}</annotation></semantics></math></p>
<p>When
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is large, we can state that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>⋘</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">a \lll N</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>≈</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N / (N + 1) \approx 1</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><msub><mi>T</mi><mi>s</mi></msub><msub><mi>T</mi><mn>0</mn></msub></mfrac><mo>≈</mo><mfrac><mrow><mi>a</mi><mi>b</mi><mo>+</mo><mi>b</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>a</mi><mo>+</mo><mn>1</mn><mo>+</mo><mn>1</mn><mi>/</mi><mi>r</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_s}{T_0} \approx \frac{a b + b + 1}{a + 1 + 1 / r}</annotation></semantics></math></p>
<div class="figure">
<img src="split_by_files/figure-html/ratio-1.png" alt="Storage space required using `split_by` relative to storing a single file." width="576"><p class="caption">
Storage space required using <code>split_by</code> relative to storing a
single file.
</p>
</div>
<p>The figure illustrates that using <code>split_by</code> is more
efficient when the number of unique combinations
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>s</mi></msub><annotation encoding="application/x-tex">N_s</annotation></semantics></math>)
of the <code>split_by</code> variables is much smaller than the number
of rows in the dataframe
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>).
The efficiency also increases when the storage for a single combination
of <code>split_by</code> variables
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>)
is larger than the storage needed for a single line of the remain
variables
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>).
The storage needed for a single line of the remain variables
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>)
doesn’t influence the efficiency.</p>
</div>
<div class="section level2">
<h2 id="benchmarking">Benchmarking<a class="anchor" aria-label="anchor" href="#benchmarking"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.github.io/git2rdata/">git2rdata</a></span><span class="op">)</span></span>
<span><span class="va">root</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"git2rdata-split-by"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">root</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  part_1 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">airbag</span>, <span class="st">"part_1"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span><span class="op">)</span>,</span>
<span>  part_2 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">airbag</span>, <span class="st">"part_2"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span>, split_by <span class="op">=</span> <span class="st">"airbag"</span><span class="op">)</span>,</span>
<span>  part_3 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">airbag</span>, <span class="st">"part_3"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span>, split_by <span class="op">=</span> <span class="st">"abcat"</span><span class="op">)</span>,</span>
<span>  part_4 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span></span>
<span>    <span class="va">airbag</span>, <span class="st">"part_4"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span>, split_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"airbag"</span>, <span class="st">"sex"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  part_5 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">airbag</span>, <span class="st">"part_5"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span>, split_by <span class="op">=</span> <span class="st">"dvcat"</span><span class="op">)</span>,</span>
<span>  part_6 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span></span>
<span>    <span class="va">airbag</span>, <span class="st">"part_6"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span>, split_by <span class="op">=</span> <span class="st">"yearacc"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  part_15 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span></span>
<span>    <span class="va">airbag</span>, <span class="st">"part_15"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span>, split_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dvcat"</span>, <span class="st">"abcat"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  part_45 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span></span>
<span>    <span class="va">airbag</span>, <span class="st">"part_45"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span>, split_by <span class="op">=</span> <span class="st">"yearVeh"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  part_270 <span class="op">=</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span></span>
<span>    <span class="va">airbag</span>, <span class="st">"part_270"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"X"</span>, split_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yearacc"</span>, <span class="st">"yearVeh"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mb</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">mb</span><span class="op">$</span><span class="va">time</span> <span class="op">/</span> <span class="fl">1e6</span></span></code></pre></div>
<p>Splitting the dataframe over more than one file takes more time to
write the data. The log time seems to increase quadratic with log number
of parts.</p>
<div class="figure">
<img src="split_by_files/figure-html/plot_write_timings-1.png" alt="Boxplot of the write timings for different number of parts." width="576"><p class="caption">
Boxplot of the write timings for different number of parts.
</p>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  part_1 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_1"</span>, <span class="va">root</span><span class="op">)</span>,</span>
<span>  part_2 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_2"</span>, <span class="va">root</span><span class="op">)</span>,</span>
<span>  part_3 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_3"</span>, <span class="va">root</span><span class="op">)</span>,</span>
<span>  part_4 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_4"</span>, <span class="va">root</span><span class="op">)</span>,</span>
<span>  part_5 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_5"</span>, <span class="va">root</span><span class="op">)</span>,</span>
<span>  part_6 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_6"</span>, <span class="va">root</span><span class="op">)</span>,</span>
<span>  part_15 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_15"</span>, <span class="va">root</span><span class="op">)</span>,</span>
<span>  part_45 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_45"</span>, <span class="va">root</span><span class="op">)</span>,</span>
<span>  part_270 <span class="op">=</span> <span class="fu"><a href="../reference/read_vc.html">read_vc</a></span><span class="op">(</span><span class="st">"part_270"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mb_r</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">mb_r</span><span class="op">$</span><span class="va">time</span> <span class="op">/</span> <span class="fl">1e6</span></span></code></pre></div>
<p>A small number of parts does not seem to affect the read timings
much. Above ten parts, the required time for reading seems to increase.
The log time seems to increase quadratic with log number of parts.</p>
<div class="figure">
<img src="split_by_files/figure-html/plot_read_timings-1.png" alt="Boxplot of the read timings for the different number of parts." width="576"><p class="caption">
Boxplot of the read timings for the different number of parts.
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.muscardinus.be" class="external-link">Thierry Onkelinx</a>, <a href="https://www.vlaanderen.be/inbo/en-gb" class="external-link"><img src="https://ropensci.github.io/git2rdata/reference/figures/logo-en.png" height="24" alt="logo of the Research Institute for Nature and Forest (INBO)"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
